module.exports = [
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/shared/lib/no-fallback-error.external.js [external] (next/dist/shared/lib/no-fallback-error.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/shared/lib/no-fallback-error.external.js", () => require("next/dist/shared/lib/no-fallback-error.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/node:buffer [external] (node:buffer, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:buffer", () => require("node:buffer"));

module.exports = mod;
}),
"[externals]/events [external] (events, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("events", () => require("events"));

module.exports = mod;
}),
"[externals]/process [external] (process, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("process", () => require("process"));

module.exports = mod;
}),
"[externals]/net [external] (net, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("net", () => require("net"));

module.exports = mod;
}),
"[externals]/tls [external] (tls, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("tls", () => require("tls"));

module.exports = mod;
}),
"[externals]/timers [external] (timers, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("timers", () => require("timers"));

module.exports = mod;
}),
"[externals]/stream [external] (stream, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}),
"[externals]/buffer [external] (buffer, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("buffer", () => require("buffer"));

module.exports = mod;
}),
"[externals]/string_decoder [external] (string_decoder, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("string_decoder", () => require("string_decoder"));

module.exports = mod;
}),
"[externals]/crypto [external] (crypto, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("crypto", () => require("crypto"));

module.exports = mod;
}),
"[externals]/zlib [external] (zlib, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("zlib", () => require("zlib"));

module.exports = mod;
}),
"[externals]/util [external] (util, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("util", () => require("util"));

module.exports = mod;
}),
"[externals]/url [external] (url, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}),
"[project]/college_of_information_technology2/lib/db.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "default",
    ()=>__TURBOPACK__default__export__,
    "query",
    ()=>query,
    "queryOne",
    ()=>queryOne
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$college_of_information_technology2$2f$node_modules$2f$mysql2$2f$promise$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/college_of_information_technology2/node_modules/mysql2/promise.js [app-route] (ecmascript)");
;
const pool = __TURBOPACK__imported__module__$5b$project$5d2f$college_of_information_technology2$2f$node_modules$2f$mysql2$2f$promise$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].createPool({
    host: process.env.DB_HOST || 'localhost',
    user: process.env.DB_USER || 'root',
    password: process.env.DB_PASSWORD || '',
    database: process.env.DB_NAME || 'cite_es',
    waitForConnections: true,
    connectionLimit: 10,
    queueLimit: 0
});
async function query(sql, values) {
    const connection = await pool.getConnection();
    try {
        const [results] = await connection.execute(sql, values);
        return results;
    } finally{
        connection.release();
    }
}
async function queryOne(sql, values) {
    const results = await query(sql, values);
    return Array.isArray(results) && results.length > 0 ? results[0] : null;
}
const __TURBOPACK__default__export__ = pool;
}),
"[project]/college_of_information_technology2/app/api/auth/route.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "POST",
    ()=>POST
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$college_of_information_technology2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/college_of_information_technology2/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$college_of_information_technology2$2f$lib$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/college_of_information_technology2/lib/db.ts [app-route] (ecmascript)");
;
;
let jwt = null;
async function loadJWT() {
    if (!jwt) {
        const jwtModule = await __turbopack_context__.A("[project]/college_of_information_technology2/node_modules/jsonwebtoken/index.js [app-route] (ecmascript, async loader)");
        jwt = jwtModule.default || jwtModule;
    }
    return jwt;
}
function getClientIp(request) {
    return request.headers.get('x-forwarded-for') || request.headers.get('x-real-ip') || 'unknown';
}
async function generateToken(userId, role) {
    const jwtLib = await loadJWT();
    return jwtLib.sign({
        userId,
        role
    }, process.env.JWT_SECRET || 'secret', {
        expiresIn: '24h'
    });
}
async function POST(request) {
    const clientIp = getClientIp(request);
    const userAgent = request.headers.get('user-agent') || '';
    try {
        const body = await request.json();
        const { action } = body;
        if (action === 'email-login') {
            return await handleEmailLogin(body, clientIp, userAgent);
        }
        if (action === 'google-login') {
            return await handleGoogleLogin(body, clientIp, userAgent);
        }
        if (action === 'signup') {
            return await handleSignup(body, clientIp, userAgent);
        }
        if (action === 'logout') {
            return await handleLogout(body, clientIp, userAgent);
        }
        return __TURBOPACK__imported__module__$5b$project$5d2f$college_of_information_technology2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: 'Invalid action'
        }, {
            status: 400
        });
    } catch (error) {
        console.error('Auth error:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$college_of_information_technology2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: 'Internal server error'
        }, {
            status: 500
        });
    }
}
async function handleEmailLogin(body, clientIp, userAgent) {
    try {
        const { email, password } = body;
        if (!email || !password) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$college_of_information_technology2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Email and password are required'
            }, {
                status: 400
            });
        }
        // Verify email domain
        if (!email.endsWith('@jmc.edu.ph')) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$college_of_information_technology2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Access denied. Please use your official JMC institutional account (@jmc.edu.ph)'
            }, {
                status: 403
            });
        }
        // Allow specific demo accounts with provided passwords
        const demoAccounts = {
            'rubygrace.ones@jmc.edu.ph': {
                id: 1001,
                name: 'Ruby Grace Ones',
                role: 'student',
                password: 'student123'
            },
            'ryan.billera@jmc.edu.ph': {
                id: 1002,
                name: 'Ryan Billera',
                role: 'teacher',
                password: 'teacher123'
            },
            'janette.claro@jmc.edu.ph': {
                id: 1003,
                name: 'Ms. Jannete Claro',
                role: 'dean',
                password: 'admin123'
            }
        };
        if (demoAccounts[email]) {
            const acct = demoAccounts[email];
            if (password === acct.password) {
                const demoToken = await generateToken(acct.id, acct.role);
                return __TURBOPACK__imported__module__$5b$project$5d2f$college_of_information_technology2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                    success: true,
                    user: {
                        id: acct.id,
                        name: acct.name,
                        email,
                        role: acct.role
                    },
                    token: demoToken,
                    message: 'Demo login'
                });
            }
            return __TURBOPACK__imported__module__$5b$project$5d2f$college_of_information_technology2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Invalid email or password'
            }, {
                status: 401
            });
        }
        // Query database for user
        const user = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$college_of_information_technology2$2f$lib$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["queryOne"])('SELECT id, email, first_name, last_name, role FROM users WHERE email = ? AND is_active = 1', [
            email
        ]);
        if (!user) {
            // Demo fallback - allow demo login with any @jmc.edu.ph email
            if (password === 'demo') {
                const nameParts = email.split('@')[0].split('.');
                const firstName = nameParts[0]?.charAt(0).toUpperCase() + nameParts[0]?.slice(1) || 'User';
                const lastName = nameParts[1]?.charAt(0).toUpperCase() + nameParts[1]?.slice(1) || 'Account';
                const demoToken = await generateToken(999, 'student');
                return __TURBOPACK__imported__module__$5b$project$5d2f$college_of_information_technology2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                    success: true,
                    user: {
                        id: 999,
                        name: `${firstName} ${lastName}`,
                        email: email,
                        role: 'student'
                    },
                    token: demoToken,
                    message: 'Demo login - data not persisted'
                });
            }
            return __TURBOPACK__imported__module__$5b$project$5d2f$college_of_information_technology2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Invalid email or password'
            }, {
                status: 401
            });
        }
        // TODO: Implement actual password hashing verification
        // For now, accept "demo" as password for database users too
        if (password !== 'demo') {
            return __TURBOPACK__imported__module__$5b$project$5d2f$college_of_information_technology2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Invalid email or password'
            }, {
                status: 401
            });
        }
        // Generate token with real user data
        const token = await generateToken(user.id, user.role);
        // Log login to audit
        await (0, __TURBOPACK__imported__module__$5b$project$5d2f$college_of_information_technology2$2f$lib$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["query"])('INSERT INTO audit_logs (user_id, action, description, ip_address, user_agent, status) VALUES (?, ?, ?, ?, ?, ?)', [
            user.id,
            'LOGIN',
            'User login via email',
            clientIp,
            userAgent,
            'success'
        ]);
        // Create session record
        await (0, __TURBOPACK__imported__module__$5b$project$5d2f$college_of_information_technology2$2f$lib$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["query"])('INSERT INTO sessions (user_id, token, ip_address, user_agent, expires_at) VALUES (?, ?, ?, ?, DATE_ADD(NOW(), INTERVAL 24 HOUR))', [
            user.id,
            token,
            clientIp,
            userAgent
        ]);
        return __TURBOPACK__imported__module__$5b$project$5d2f$college_of_information_technology2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: true,
            user: {
                id: user.id,
                name: `${user.first_name} ${user.last_name}`,
                email: user.email,
                role: user.role
            },
            token
        });
    } catch (error) {
        console.error('Email login error:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$college_of_information_technology2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: 'Login failed',
            details: String(error)
        }, {
            status: 500
        });
    }
}
async function handleGoogleLogin(body, clientIp, userAgent) {
    try {
        const { googleToken } = body;
        if (!googleToken) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$college_of_information_technology2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Google token is required'
            }, {
                status: 400
            });
        }
        // For demo mode - use test user
        const email = 'test.user@jmc.edu.ph';
        const firstName = 'Test';
        const lastName = 'User';
        const userId = 1;
        // Verify email domain
        if (!email.endsWith('@jmc.edu.ph')) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$college_of_information_technology2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Access denied. Please use your official JMC institutional account.'
            }, {
                status: 403
            });
        }
        // Generate token
        const token = await generateToken(userId, 'student');
        return __TURBOPACK__imported__module__$5b$project$5d2f$college_of_information_technology2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: true,
            user: {
                id: userId,
                name: `${firstName} ${lastName}`,
                email: email,
                role: 'student'
            },
            token
        });
    } catch (error) {
        console.error('Google login error:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$college_of_information_technology2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: 'Login failed',
            details: String(error)
        }, {
            status: 500
        });
    }
}
async function handleSignup(body, clientIp, userAgent) {
    try {
        const { email, firstName, lastName, jmcId, password, role } = body;
        // Validate required fields
        if (!email || !firstName || !lastName || !jmcId || !password || !role) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$college_of_information_technology2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'All fields are required'
            }, {
                status: 400
            });
        }
        // Validate role
        if (role === 'dean') {
            return __TURBOPACK__imported__module__$5b$project$5d2f$college_of_information_technology2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Dean accounts cannot be created through signup'
            }, {
                status: 403
            });
        }
        // Verify email domain
        if (!email.endsWith('@jmc.edu.ph')) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$college_of_information_technology2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Please use your official JMC institutional email'
            }, {
                status: 400
            });
        }
        // Demo mode - accept signup
        return __TURBOPACK__imported__module__$5b$project$5d2f$college_of_information_technology2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: true,
            message: 'Account created successfully. Please check your email to verify your account.'
        });
    } catch (error) {
        console.error('Signup error:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$college_of_information_technology2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: 'Signup failed',
            details: String(error)
        }, {
            status: 500
        });
    }
}
async function handleLogout(body, clientIp, userAgent) {
    try {
        const { token } = body;
        if (!token) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$college_of_information_technology2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Token is required'
            }, {
                status: 400
            });
        }
        // Demo mode - accept logout
        return __TURBOPACK__imported__module__$5b$project$5d2f$college_of_information_technology2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: true,
            message: 'Logged out successfully'
        });
    } catch (error) {
        console.error('Logout error:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$college_of_information_technology2$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: 'Logout failed',
            details: String(error)
        }, {
            status: 500
        });
    }
}
}),
];

//# sourceMappingURL=%5Broot-of-the-server%5D__b1f97ea3._.js.map